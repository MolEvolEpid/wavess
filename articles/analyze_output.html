<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analyze wavess output • wavess</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyze wavess output">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">wavess</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/prepare_input_data.html">Prepare input data</a></li>
    <li><a class="dropdown-item" href="../articles/run_wavess.html">Simulate within-host evolution with `wavess`</a></li>
    <li><a class="dropdown-item" href="../articles/analyze_output.html">Analyze wavess output</a></li>
    <li><a class="dropdown-item" href="../articles/python.html">Running wavess in Python</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Analyze wavess output</h1>
            
      

      <div class="d-none name"><code>analyze_output.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we’ll provide various ways to analyze the output of
<code><a href="../reference/run_wavess.html">run_wavess()</a></code>. Note that many of these functions can also be
used to analyze real-world empirical data.</p>
<p>For simulated data, we highly recommend comparing the output to
empirical data, or at least using your domain knowledge to determine
whether the output seems reasonable. If it doesn’t, you may have to
tweak various input parameters to get believable outputs. The default
input parameters we provide generally lead to a reasonable output for
HIV, but even so, due to the stochastic nature of the model, some
outputs look more like real data than others.</p>
<div class="section level2">
<h2 id="run-wavess">Run wavess<a class="anchor" aria-label="anchor" href="#run-wavess"></a>
</h2>
<p>First, let’s load the relevant libraries, set the default plotting
theme, and run wavess including all the selective pressures. We’re going
to set a seed for reproducibility. For more details on the input and
running wavess, please see the respective vignettes.
(<code><a href="../articles/prepare_input_data.html">vignette("prepare_input_data")</a></code> and
<code><a href="../articles/run_wavess.html">vignette("run_wavess")</a></code>). If you haven’t checked out those
vignettes first, be sure to at least run the
<code><a href="../reference/create_python_venv.html">create_python_venv()</a></code> function prior to running the below
code, or else you’ll get an error telling you to do so.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://molevolepid.github.io/wavess/">wavess</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ape'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     where</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/KlausVigo/phangorn" class="external-link">phangorn</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.amazon.com/Integration-Manipulation-Visualization-Phylogenetic-Computational-ebook/dp/B0B5NLZR1Z/" class="external-link">ggtree</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ggtree v3.16.0 Learn more at https://yulab-smu.top/contribution-tree-data/</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Please cite:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Guangchuang Yu, David Smith, Huachen Zhu, Yi Guan, Tommy Tsan-Yuk Lam.</span></span>
<span><span class="co">#&gt; ggtree: an R package for visualization and annotation of phylogenetic</span></span>
<span><span class="co">#&gt; trees with their covariates and other associated data. Methods in</span></span>
<span><span class="co">#&gt; Ecology and Evolution. 2017, 8(1):28-36. doi:10.1111/2041-210X.12628</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ggtree'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:ape':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     rotate</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:tidyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     expand</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># if needed</span></span>
<span><span class="fu"><a href="../reference/create_python_venv.html">create_python_venv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using Python: /usr/bin/python3.12</span></span>
<span><span class="co">#&gt; Creating virtual environment 'r-wavess' ...</span></span>
<span><span class="co">#&gt; + /usr/bin/python3.12 -m venv /home/runner/.virtualenvs/r-wavess</span></span>
<span><span class="co">#&gt; Done!</span></span>
<span><span class="co">#&gt; Installing packages: pip, wheel, setuptools</span></span>
<span><span class="co">#&gt; + /home/runner/.virtualenvs/r-wavess/bin/python -m pip install --upgrade pip wheel setuptools</span></span>
<span><span class="co">#&gt; Installing packages: numpy</span></span>
<span><span class="co">#&gt; + /home/runner/.virtualenvs/r-wavess/bin/python -m pip install --upgrade --no-user numpy</span></span>
<span><span class="co">#&gt; Virtual environment 'r-wavess' successfully created.</span></span>
<span><span class="co">#&gt; Using virtual environment 'r-wavess' ...</span></span>
<span><span class="co">#&gt; + /home/runner/.virtualenvs/r-wavess/bin/python -m pip install --upgrade --no-user scipy</span></span>
<span><span class="co">#&gt; Installation of scipy version 1.15.2 complete.</span></span>
<span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_growth_curve.html">define_growth_curve</a></span><span class="op">(</span>n_gens <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_sampling_scheme.html">define_sampling_scheme</a></span><span class="op">(</span>sampling_frequency_active <span class="op">=</span> <span class="fl">30</span>, max_samp_active <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">day</span> <span class="op">&lt;=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="va">founder_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_seqs.html">extract_seqs</a></span><span class="op">(</span><span class="va">hxb2_cons_founder</span>,</span>
<span>  founder <span class="op">=</span> <span class="st">"B.US.2011.DEMB11US006.KC473833"</span>,</span>
<span>  ref <span class="op">=</span> <span class="st">"CON_B(1295)"</span>,</span>
<span>  start <span class="op">=</span> <span class="fl">6225</span>, end <span class="op">=</span> <span class="fl">7787</span></span>
<span><span class="op">)</span></span>
<span><span class="va">gp120</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slice_aln.html">slice_aln</a></span><span class="op">(</span><span class="va">hxb2_cons_founder</span>, <span class="fl">6225</span>, <span class="fl">7787</span><span class="op">)</span></span>
<span><span class="va">epi_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_epitope_frequencies.html">get_epitope_frequencies</a></span><span class="op">(</span><span class="va">env_features</span><span class="op">$</span><span class="va">Position</span><span class="op">)</span></span>
<span><span class="va">ref_founder_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_ref_founder.html">map_ref_founder</a></span><span class="op">(</span><span class="va">gp120</span>,</span>
<span>  ref <span class="op">=</span> <span class="st">"B.FR.83.HXB2_LAI_IIIB_BRU.K03455"</span>,</span>
<span>  founder <span class="op">=</span> <span class="st">"B.US.2011.DEMB11US006.KC473833"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">epitope_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_epitopes.html">sample_epitopes</a></span><span class="op">(</span><span class="va">epi_probs</span>,</span>
<span>  ref_founder_map <span class="op">=</span> <span class="va">ref_founder_map</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 12 resamples required</span></span>
<span></span>
<span><span class="va">wavess_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_wavess.html">run_wavess</a></span><span class="op">(</span></span>
<span>  inf_pop_size <span class="op">=</span> <span class="va">pop</span>,</span>
<span>  samp_scheme <span class="op">=</span> <span class="va">samp</span>,</span>
<span>  founder_seqs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">founder_ref</span><span class="op">$</span><span class="va">founder</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  conserved_sites <span class="op">=</span> <span class="va">founder_conserved_sites</span>,</span>
<span>  ref_seq <span class="op">=</span> <span class="va">founder_ref</span><span class="op">$</span><span class="va">ref</span>,</span>
<span>  epitope_locations <span class="op">=</span> <span class="va">epitope_locations</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1234</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting-counts">Plotting counts<a class="anchor" aria-label="anchor" href="#plotting-counts"></a>
</h2>
<p>Here are various counts and mean fitness values plotted over
time:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wavess_out</span><span class="op">$</span><span class="va">counts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">generation</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">generation</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyze_output_files/figure-html/plot_counts-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="diversity-and-divergence">Diversity and divergence<a class="anchor" aria-label="anchor" href="#diversity-and-divergence"></a>
</h2>
<p>Within-generation diversity and divergence from the founder sequence
across time can be computed and plotted as follows (reference for
calculations <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1004625" class="external-link">here</a>):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"gen|_.*"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/labels.html" class="external-link">labels</a></span><span class="op">(</span><span class="va">wavess_out</span><span class="op">$</span><span class="va">seqs_active</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">div_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_div_metrics.html">calc_div_metrics</a></span><span class="op">(</span><span class="va">wavess_out</span><span class="op">$</span><span class="va">seqs_active</span>, <span class="st">"founder0"</span>, <span class="va">gens</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">diversity</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 17 × 3</span></span></span>
<span><span class="co">#&gt;    gen   diversity divergence</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0       0         0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 30      0.001<span style="text-decoration: underline;">04</span>   0.000<span style="text-decoration: underline;">532</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 60      0.001<span style="text-decoration: underline;">79</span>   0.000<span style="text-decoration: underline;">918</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 90      0.002<span style="text-decoration: underline;">81</span>   0.001<span style="text-decoration: underline;">44</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 120     0.005<span style="text-decoration: underline;">44</span>   0.003<span style="text-decoration: underline;">19</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 150     0.006<span style="text-decoration: underline;">60</span>   0.004<span style="text-decoration: underline;">19</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 180     0.007<span style="text-decoration: underline;">23</span>   0.004<span style="text-decoration: underline;">78</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 210     0.007<span style="text-decoration: underline;">69</span>   0.005<span style="text-decoration: underline;">15</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 240     0.008<span style="text-decoration: underline;">93</span>   0.005<span style="text-decoration: underline;">85</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 270     0.011<span style="text-decoration: underline;">6</span>    0.007<span style="text-decoration: underline;">17</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 300     0.012<span style="text-decoration: underline;">3</span>    0.007<span style="text-decoration: underline;">66</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 330     0.012<span style="text-decoration: underline;">3</span>    0.008<span style="text-decoration: underline;">64</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 360     0.013<span style="text-decoration: underline;">3</span>    0.008<span style="text-decoration: underline;">96</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 390     0.014<span style="text-decoration: underline;">9</span>    0.009<span style="text-decoration: underline;">34</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 420     0.012<span style="text-decoration: underline;">7</span>    0.008<span style="text-decoration: underline;">46</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 450     0.012<span style="text-decoration: underline;">1</span>    0.008<span style="text-decoration: underline;">86</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> 480     0.015<span style="text-decoration: underline;">8</span>    0.010<span style="text-decoration: underline;">8</span></span></span></code></pre></div>
<p>As can be seen, the diversity of founder0 and generation 0 are NaN.
This is because there is only one sampled sequence at those timepoints,
so diversity cannot be computed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">div_metrics</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">gen</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">gen</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">gen</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="analyze_output_files/figure-html/plot_div-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="phylogeny">Phylogeny<a class="anchor" aria-label="anchor" href="#phylogeny"></a>
</h2>
<p><strong>We HIGHLY recommend using a maximum-likelihood (or Bayesian)
tree-building algorithm outside of R such as <a href="http://www.iqtree.org/" class="external-link">IQ-TREE</a> for your tree-based analyses
of the simulated sequences.</strong> That being said, it is sometimes
nice, like here, to build a quick tree to get a sense of what the output
of your simulations looks like. Below is a way to quickly build a tree
in R using <code>ape</code> to generate a neighbor-joining tree and
<code>phangorn</code> to estimate branch lengths using maximum
likelihood. (Note that you can also modify the below code to estimate a
full maximum-likelihood tree in R by deleting
<code>rearrangement = "none"</code>, just be prepared for it to take a
long time to run - longer than it would take to run IQ-TREE.)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seqs_active</span> <span class="op">&lt;-</span> <span class="va">wavess_out</span><span class="op">$</span><span class="va">seqs_active</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"founder0|gen30|gen90|gen150|gen480"</span>, <span class="fu"><a href="https://rdrr.io/r/base/labels.html" class="external-link">labels</a></span><span class="op">(</span><span class="va">wavess_out</span><span class="op">$</span><span class="va">seqs_active</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">pml_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://klausvigo.github.io/phangorn/reference/pml_bb.html" class="external-link">pml_bb</a></span><span class="op">(</span><span class="va">seqs_active</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/bionj.html" class="external-link">bionj</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/dist.dna.html" class="external-link">dist.dna</a></span><span class="op">(</span><span class="va">seqs_active</span>, model <span class="op">=</span> <span class="st">"TN93"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"GTR+I+R(4)"</span>, rearrangement <span class="op">=</span> <span class="st">"none"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; optimize edge weights:  -7685.642 --&gt; -7634.551 </span></span>
<span><span class="co">#&gt; optimize rate matrix:  -7634.551 --&gt; -7348.021 </span></span>
<span><span class="co">#&gt; optimize invariant sites:  -7348.021 --&gt; -7095.98 </span></span>
<span><span class="co">#&gt; optimize free rate parameters:  -7095.98 --&gt; -6424.452 </span></span>
<span><span class="co">#&gt; optimize edge weights:  -6424.452 --&gt; -6420.2 </span></span>
<span><span class="co">#&gt; optimize rate matrix:  -6420.2 --&gt; -6419.492 </span></span>
<span><span class="co">#&gt; optimize invariant sites:  -6419.492 --&gt; -6419.492 </span></span>
<span><span class="co">#&gt; optimize free rate parameters:  -6419.492 --&gt; -6419.288 </span></span>
<span><span class="co">#&gt; optimize edge weights:  -6419.288 --&gt; -6419.286 </span></span>
<span><span class="co">#&gt; optimize rate matrix:  -6419.286 --&gt; -6419.284 </span></span>
<span><span class="co">#&gt; optimize invariant sites:  -6419.284 --&gt; -6419.284 </span></span>
<span><span class="co">#&gt; optimize free rate parameters:  -6419.284 --&gt; -6419.282 </span></span>
<span><span class="co">#&gt; optimize edge weights:  -6419.282 --&gt; -6419.282 </span></span>
<span><span class="co">#&gt; optimize rate matrix:  -6419.282 --&gt; -6419.282 </span></span>
<span><span class="co">#&gt; optimize invariant sites:  -6419.282 --&gt; -6419.282 </span></span>
<span><span class="co">#&gt; optimize free rate parameters:  -6419.282 --&gt; -6419.282 </span></span>
<span><span class="co">#&gt; optimize edge weights:  -6419.282 --&gt; -6419.282 </span></span>
<span><span class="co">#&gt; optimize rate matrix:  -6419.282 --&gt; -6419.282 </span></span>
<span><span class="co">#&gt; optimize invariant sites:  -6419.282 --&gt; -6419.282 </span></span>
<span><span class="co">#&gt; optimize free rate parameters:  -6419.282 --&gt; -6419.282 </span></span>
<span><span class="co">#&gt; optimize edge weights:  -6419.282 --&gt; -6419.282</span></span>
<span></span>
<span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/root.html" class="external-link">root</a></span><span class="op">(</span><span class="va">pml_out</span><span class="op">$</span><span class="va">tree</span>, <span class="st">"founder0"</span>, resolve.root <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">gens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"gen|_.*"</span>, <span class="st">""</span>, <span class="va">tr</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gens</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tr</span><span class="op">$</span><span class="va">tip.label</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html" class="external-link">ggtree</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tippoint.html" class="external-link">geom_tippoint</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gens</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html" class="external-link">Nnode</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"founder0"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">gens</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_treescale.html" class="external-link">geom_treescale</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"Generation"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in unique(as.numeric(gens)): NAs introduced by coercion</span></span></code></pre></div>
<p><img src="analyze_output_files/figure-html/plot_tree-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="phylogeny-summary-statistics">Phylogeny summary statistics<a class="anchor" aria-label="anchor" href="#phylogeny-summary-statistics"></a>
</h2>
<p>Using the tree generated above, we provide the functionality to
compute some phylogenetic summary statistics:</p>
<ul>
<li>The <a href="https://treebalance.wordpress.com/average-leaf-depth/" class="external-link">mean leaf
depth</a>, the Sackin index normalized by the number of tree tips.</li>
<li>The the mean branch length, mean internal branch length, and mean
external branch length.</li>
<li>The transition score of the phylogeny with the tips labeled as
timepoints, normalized by the. number of timepoints.</li>
<li>The mean per-generation divergence (root-to-tip distance) and
diversity (tip-to-tip distance).</li>
<li>The slope of divergence and diversity over time.</li>
</ul>
<p>Many other tree statistics can be calculated using the <a href="https://treebalance.wordpress.com/" class="external-link"><code>treebalance</code></a>
package.</p>
<p><strong>Note that these summary statistics can only reliably be
compared for trees that are derived from the same sampling scheme,
i.e. the same number of samples taken at the same time points
post-infection.</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calc_tr_stats.html">calc_tr_stats</a></span><span class="op">(</span><span class="va">tr</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gens</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"founder0"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">gens</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in unique(as.numeric(gens)): NAs introduced by coercion</span></span>
<span><span class="co">#&gt; Warning in FUN(X[[i]], ...): Generation founder0 has only one tip, cannot</span></span>
<span><span class="co">#&gt; calculate diversity.</span></span>
<span><span class="co">#&gt; Warning: There was 1 warning in `dplyr::mutate()`.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `timepoint = as.numeric(as.character(.data$timepoint))`.</span></span>
<span><span class="co">#&gt; Caused by warning:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> NAs introduced by coercion</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 2</span></span></span>
<span><span class="co">#&gt;   stat_name        stat_value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> mean_leaf_depth  24.3      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> mean_bl           0.001<span style="text-decoration: underline;">47</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> mean_int_bl       0.001<span style="text-decoration: underline;">18</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> mean_ext_bl       0.001<span style="text-decoration: underline;">75</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> mean_divergence   0.007<span style="text-decoration: underline;">66</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> mean_diversity    0.014<span style="text-decoration: underline;">3</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> divergence_slope  0.000<span style="text-decoration: underline;">048</span>0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> diversity_slope   0.000<span style="text-decoration: underline;">067</span>3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> transition_score 10.6</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zena Lapp, Narmada Sambaturu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
